[pytest]
# isA Microservices Test Configuration
# See tests/README.md for documentation

# Test discovery
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Default options
addopts = -v --tb=short --strict-markers

# Async support
asyncio_mode = auto
asyncio_default_fixture_loop_scope = session
asyncio_default_test_loop_scope = session

# Markers for test categorization
markers =
    # Test Layer Markers (use at least one)
    unit: Layer 1 - Pure functions, no I/O, no dependencies
    component: Layer 2 - Mocked dependencies via DI
    integration: Layer 3 - Real DB, bypass auth (X-Internal-Call)
    api: Layer 4 - Real auth flow with JWT
    smoke: Layer 5 - Full E2E with all infrastructure

    # Test Type Markers
    golden: Captures CURRENT behavior (for existing services)
    tdd: Defines EXPECTED behavior (for new features/fixes)

    # Infrastructure Requirement Markers
    requires_db: Test requires PostgreSQL database
    requires_nats: Test requires NATS message bus
    requires_redis: Test requires Redis cache
    requires_minio: Test requires MinIO storage
    requires_auth: Test requires auth_service running

    # Speed/Priority Markers
    slow: Test takes more than 5 seconds
    fast: Test completes in under 1 second

    # Service-specific Markers (add as needed)
    account: Tests for account_service
    auth: Tests for auth_service
    device: Tests for device_service
    media: Tests for media_service
    memory: Tests for memory_service
    storage: Tests for storage_service
    notification: Tests for notification_service

# Logging
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)s] %(name)s: %(message)s
log_cli_date_format = %H:%M:%S

# Timeout for async tests (in seconds)
timeout = 30

# Filter warnings
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning

# Minimum Python version
minversion = 3.11
